<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gold Decision Radar v3.1</title>

<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

<style>
body{background:#0b0f14;color:#e5e7eb;font-family:system-ui;margin:0;padding:16px}
.pill{padding:6px 10px;border-radius:999px;border:1px solid #334155;background:#02061740;font-size:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}

.inr-up{
 border-color: rgba(239,68,68,.35)!important;
 color: rgba(254,202,202,1)!important;
}
.inr-down{
 border-color: rgba(34,197,94,.35)!important;
 color: rgba(187,247,208,1)!important;
}
.inr-flat{
 border-color: rgba(245,158,11,.35)!important;
 color: rgba(253,230,138,1)!important;
}
</style>
</head>

<body>

<h2>Gold Decision Radar v3.1</h2>

<div class="row">
<span class="pill" id="status">Status: ready</span>
<span class="pill" id="asOf">As of: —</span>
<span class="pill" id="fresh">Sources: —</span>
</div>

<div class="row">
<span class="pill" id="usdInrSpot">USD/INR: —</span>
</div>

<button onclick="autoFetch()">Auto Fetch</button>

<script>

const $ = (id)=>document.getElementById(id);

async function autoFetch(){

 $("status").textContent="Status: fetching…";

 try{

  const res = await fetch("/api/market",{cache:"no-store"});
  if(!res.ok) throw new Error(res.status);

  const data = await res.json();

  if(Number.isFinite(data.usdInr)){

   const pct = Number.isFinite(data.usdInrChangePct30d)
              ? data.usdInrChangePct30d
              : null;

   let arrow="→";
   let cls="inr-flat";

   if(pct!==null){
    if(pct>0.2){arrow="↑";cls="inr-up";}
    else if(pct<-0.2){arrow="↓";cls="inr-down";}
   }

   const pctText =
    pct===null ? "" :
    ` | 30d: ${pct>=0?"+":""}${pct.toFixed(2)}% ${arrow}`;

   const el=$("usdInrSpot");

   el.textContent =
    `USD/INR: ${data.usdInr.toFixed(2)}${pctText}`;

   el.classList.remove("inr-up","inr-down","inr-flat");
   el.classList.add(cls);
  }

  $("asOf").textContent = "As of: "+data.asOf;
  $("status").textContent="Status: fetched ✓";

 }
 catch(e){
  $("status").textContent="Status: fetch failed (manual works)";
 }
}

</script>

</body>
</html>

